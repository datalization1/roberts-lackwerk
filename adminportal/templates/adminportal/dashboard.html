{% extends "adminportal/base.html" %}

{% block portal_content %}
<div class="fig-admin__kpis">
  <article class="fig-admin__card fig-admin__card--kpi">
    <div class="fig-admin__card-top">
      <p class="fig-admin__card-label">Schadenmeldungen</p>
      <span class="fig-admin__card-icon"><i data-lucide="file-text"></i></span>
    </div>
    <div class="fig-admin__card-value">{{ kpi.reports_total }}</div>
    <p class="fig-admin__card-meta">Ausstehend: {{ kpi.reports_pending|default:"0" }}</p>
  </article>
  <article class="fig-admin__card fig-admin__card--kpi">
    <div class="fig-admin__card-top">
      <p class="fig-admin__card-label">Buchungen</p>
      <span class="fig-admin__card-icon"><i data-lucide="calendar-check"></i></span>
    </div>
    <div class="fig-admin__card-value">{{ kpi.bookings_total }}</div>
    <p class="fig-admin__card-meta">Ausstehend: {{ kpi.bookings_pending|default:"0" }}</p>
  </article>
  <article class="fig-admin__card fig-admin__card--kpi">
    <div class="fig-admin__card-top">
      <p class="fig-admin__card-label">In Bearbeitung</p>
      <span class="fig-admin__card-icon"><i data-lucide="clock"></i></span>
    </div>
    <div class="fig-admin__card-value">{{ kpi.reports_in_progress|default:"0" }}</div>
    <p class="fig-admin__card-meta">Reparaturen aktiv</p>
  </article>
  <article class="fig-admin__card fig-admin__card--kpi">
    <div class="fig-admin__card-top">
      <p class="fig-admin__card-label">Abgeschlossen</p>
      <span class="fig-admin__card-icon"><i data-lucide="check-circle"></i></span>
    </div>
    <div class="fig-admin__card-value">{{ kpi.reports_completed|default:"0" }}</div>
    <p class="fig-admin__card-meta">Diesen Monat</p>
  </article>
</div>

<div class="fig-admin__panels">
  <section class="fig-admin__panel">
    <header class="fig-admin__panel-header">
      <h3>Neueste Schadenmeldungen</h3>
      <p class="fig-admin__panel-subtitle">Letzte Eingänge</p>
    </header>
    <div class="fig-list">
      {% for report in recent_reports %}
        <article class="fig-list__item">
          <div class="fig-list__body">
            <div class="fig-list__title">SM-{{ report.pk }}</div>
            <div class="fig-list__meta">
              {% if report.company_name %}{{ report.company_name }}{% else %}{{ report.first_name }} {{ report.last_name }}{% endif %}
              · {{ report.car_brand }} {{ report.car_model }}{% if report.plate %} · {{ report.plate }}{% endif %}
            </div>
          </div>
          <div class="fig-list__right">
            {% if report.status == "pending" %}
              <span class="fig-badge fig-badge--warning">Ausstehend</span>
            {% elif report.status == "in-progress" or report.status == "in_progress" %}
              <span class="fig-badge fig-badge--info">In Bearbeitung</span>
            {% elif report.status == "completed" %}
              <span class="fig-badge fig-badge--success">Abgeschlossen</span>
            {% elif report.status == "cancelled" %}
              <span class="fig-badge">Storniert</span>
            {% else %}
              <span class="fig-badge fig-badge--warning">Neu</span>
            {% endif %}
            <a class="fig-list__action" href="{% url 'portal_damage_report_detail' report.pk %}">
              <i data-lucide="eye"></i>
            </a>
          </div>
        </article>
      {% empty %}
        <p class="fig-empty">Noch keine Schadenmeldungen vorhanden.</p>
      {% endfor %}
    </div>
  </section>

  <section class="fig-admin__panel">
    <header class="fig-admin__panel-header">
      <h3>Anstehende Buchungen</h3>
      <p class="fig-admin__panel-subtitle">Nächste Abholtermine</p>
    </header>
    <div class="fig-list">
      {% for booking in upcoming_bookings %}
        <article class="fig-list__item">
          <div class="fig-list__body">
            <div class="fig-list__title">BU-{{ booking.pk }}</div>
            <div class="fig-list__meta">
              {{ booking.customer_name }} · Abholung: {{ booking.date|date:"Y-m-d" }}
            </div>
          </div>
          <div class="fig-list__right">
            {% if booking.status == "confirmed" %}
              <span class="fig-badge fig-badge--success">Bestätigt</span>
            {% elif booking.status == "pending" %}
              <span class="fig-badge fig-badge--warning">Ausstehend</span>
            {% elif booking.status == "active" %}
              <span class="fig-badge fig-badge--info">Aktiv</span>
            {% elif booking.status == "completed" %}
              <span class="fig-badge fig-badge--info">Abgeschlossen</span>
            {% elif booking.status == "cancelled" %}
              <span class="fig-badge">Storniert</span>
            {% else %}
              <span class="fig-badge fig-badge--success">Bestätigt</span>
            {% endif %}
            <a class="fig-list__action" href="{% url 'portal_booking_detail' booking.pk %}">
              <i data-lucide="eye"></i>
            </a>
          </div>
        </article>
      {% empty %}
        <p class="fig-empty">Keine zukünftigen Buchungen vorhanden.</p>
      {% endfor %}
    </div>
  </section>
</div>

<section class="fig-admin__panel fig-admin__panel--wide">
  <header class="fig-admin__panel-header">
    <h3>Transporter-Übersicht</h3>
    <p class="fig-admin__panel-subtitle">Verfügbare Fahrzeuge</p>
  </header>
  <div class="fig-admin__cards">
    {% for transporter in transporters %}
      <article class="fig-admin__card fig-admin__card--inline">
        <div>
          <p class="fig-admin__card-label">Name</p>
          <div class="fig-admin__card-value fig-admin__card-value--small">{{ transporter.name }}</div>
          <p class="fig-admin__card-meta">Kennzeichen: {{ transporter.kennzeichen }}</p>
        </div>
        <div class="fig-admin__card-meta">
          Verfügbar ab {{ transporter.verfuegbar_ab|date:"d.m.Y" }}
        </div>
      </article>
    {% empty %}
      <p class="fig-empty">Noch keine Transporter erfasst.</p>
    {% endfor %}
  </div>
</section>
{% endblock %}
