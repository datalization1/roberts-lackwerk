{% extends "base.html" %}

{% block body_class %}page-gold{% endblock %}

{% block content %}
<section class="rl-wizard">
  <!-- Header -->
  <header class="rl-wizard-header">
    <a href="{% url 'booking_review' %}" class="rl-back-link">‚Üê Zur√ºck zur √úbersicht</a>
    <h1 class="rl-wizard-title">Zahlung</h1>
    <p class="rl-wizard-subtitle">W√§hlen Sie Ihre Zahlungsmethode.</p>
  </header>

  <!-- Progress Card -->
  <section class="rl-wizard-card rl-wizard-card--progress">
    <div class="rl-stepper">
      <div class="rl-stepper__item is-active">
        <span class="rl-stepper__label">Mietdetails</span>
        <span class="rl-stepper__bar"><span class="rl-stepper__bar-fill"></span></span>
      </div>
      <div class="rl-stepper__item is-active">
        <span class="rl-stepper__label">Kundendaten</span>
        <span class="rl-stepper__bar"><span class="rl-stepper__bar-fill"></span></span>
      </div>
      <div class="rl-stepper__item is-active">
        <span class="rl-stepper__label">Zusatzoptionen</span>
        <span class="rl-stepper__bar"><span class="rl-stepper__bar-fill"></span></span>
      </div>
      <div class="rl-stepper__item is-active">
        <span class="rl-stepper__label">√úberpr√ºfung</span>
        <span class="rl-stepper__bar"><span class="rl-stepper__bar-fill"></span></span>
      </div>
      <div class="rl-stepper__item is-active">
        <span class="rl-stepper__label">Zahlung</span>
        <span class="rl-stepper__bar"><span class="rl-stepper__bar-fill"></span></span>
      </div>
    </div>
  </section>

  <!-- Payment Card -->
  <section class="rl-wizard-card">
    <header class="rl-wizard-card__header">
      <h2 class="rl-card__title">Zahlung</h2>
      <p class="rl-card__subtitle">W√§hlen Sie Ihre Zahlungsmethode und schlie√üen Sie die Buchung ab.</p>
    </header>

    <form method="post" class="rl-wizard-body">
      {% csrf_token %}

      <!-- Zahlungsmethode w√§hlen -->
      <div class="rl-payment-section">
        <h3 class="rl-review-title">Zahlungsmethode w√§hlen</h3>
        <div class="rl-payment-methods">
          <label class="rl-payment-card">
            <input id="payment_card" type="radio" name="payment_method" value="CARD" class="rl-payment-card__input" checked>
            <div class="rl-payment-card__inner">
              <div class="rl-payment-card__icon">üí≥</div>
              <div class="rl-payment-card__body">
                <div class="rl-payment-card__title">Kreditkarte (Stripe)</div>
                <div class="rl-payment-card__text">Bezahlen Sie sicher mit Kreditkarte</div>
                <div class="rl-payment-card__badges">
                  <span>VISA</span><span>Mastercard</span><span>AMEX</span>
                </div>
              </div>
            </div>
          </label>

          <label class="rl-payment-card">
            <input id="payment_cash" type="radio" name="payment_method" value="CASH" class="rl-payment-card__input">
            <div class="rl-payment-card__inner">
              <div class="rl-payment-card__icon">üíµ</div>
              <div class="rl-payment-card__body">
                <div class="rl-payment-card__title">Barzahlung</div>
                <div class="rl-payment-card__text">Bezahlen Sie bei Abholung in bar</div>
                <div class="rl-payment-card__hint">Zahlung bei Fahrzeug√ºbernahme</div>
              </div>
            </div>
          </label>
        </div>
      </div>

      <!-- Kreditkarten-Details (nur UI, noch ohne echte Stripe-Integration) -->
      <div id="card-details-section" class="rl-payment-section">
        <h3 class="rl-review-title">Kreditkarten-Details</h3>
        <p class="rl-review-subtext">Ihre Zahlungsdaten sind durch SSL-Verschl√ºsselung gesch√ºtzt.</p>

        <div class="rl-payment-demo">
          <strong>Demo-Modus:</strong>
          <span>Dies ist eine Testumgebung. Verwenden Sie die Testkartennummer:</span>
          <span class="rl-payment-demo-card">4242 4242 4242 4242</span>
        </div>

        <div class="rl-payment-grid">
          <div class="form-group">
            <label class="form-label">Karteninhaber</label>
            <input type="text" class="form-input" placeholder="Max Mustermann">
          </div>
          <div class="form-group">
            <label class="form-label">Kartennummer</label>
            <input type="text" class="form-input" placeholder="1234 5678 9012 3456">
          </div>
          <div class="form-group form-group--split">
            <div>
              <label class="form-label">G√ºltig bis</label>
              <input type="text" class="form-input" placeholder="MM/JJ">
            </div>
            <div>
              <label class="form-label">CVV</label>
              <input type="text" class="form-input" placeholder="123">
            </div>
          </div>
        </div>
      </div>

      <!-- Gesamtbetrag -->
      <div class="rl-review-summary rl-review-summary--compact">
        <div class="rl-review-summary-row rl-review-summary-row--total">
          <span>Gesamtbetrag</span>
          <span>{% if total_price %}CHF {{ total_price }}{% else %}CHF ‚Äì{% endif %}</span>
        </div>
      </div>

      <!-- Footer Buttons -->
      <footer class="rl-wizard-footer">
        <a href="{% url 'booking_review' %}" class="btn rl-btn-secondary">‚Üê Zur√ºck</a>
        <button type="submit" class="btn rl-btn-primary">Jetzt bezahlen{% if total_price %} (CHF {{ total_price }}){% endif %}</button>
      </footer>
    </form>
  </section>
</section>
<script>
document.addEventListener('DOMContentLoaded',function(){
  const cardRadio = document.getElementById('payment_card');
  const cashRadio = document.getElementById('payment_cash');
  const cardSection = document.getElementById('card-details-section');

  function toggleCardSection(){
    if (!cardSection || !cardRadio || !cashRadio) return;
    if (cashRadio.checked){
      cardSection.style.display = 'none';
    }else{
      cardSection.style.display = '';
    }
  }

  if (cardRadio && cashRadio){
    cardRadio.addEventListener('change', toggleCardSection);
    cashRadio.addEventListener('change', toggleCardSection);
    toggleCardSection();  // initialer Zustand
  }
});
</script>
{% endblock %}
